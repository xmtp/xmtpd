#!/bin/bash
# Deploy the smart contracts to the local anvil node
set -euo pipefail
source dev/contracts/.env
source dev/contracts/common

# Make sure the build directory exists
mkdir -p ./build

# Move to working directory
cd ./contracts

# Update depencencies
forge soldeer update &> /dev/null
if [ $? -ne 0 ]; then
  echo "ERROR: Failed to update dependencies"
  exit 1
fi

forge_deploy_script group_messages
forge_deploy_script identity_updates

# TODO: This should be a function in the forge CLI
deploy_contract src/Nodes.sol Nodes
