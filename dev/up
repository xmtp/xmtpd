#!/bin/bash
set -e

# Work always from the root directory
script_dir=$(dirname "$(realpath "$0")")
repo_root=$(realpath "${script_dir}/../")
cd "${repo_root}"

if ! which shellcheck &>/dev/null; then brew install shellcheck; fi
if ! which jq &>/dev/null; then brew install jq; fi
if ! which golangci-lint; then brew install golangci-lint; fi

echo -e "→ Update Go dependencies"
go mod tidy

echo -e "→ Start docker containers"
dev/docker/up

echo -e "→ Register local node-1"
dev/cmd/register-local-node-1

echo -e "→ Register local node-2"
dev/cmd/register-local-node-2

echo -e "→ Generating .env"
dev/generate-env
